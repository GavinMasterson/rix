---
title: "Building reproducible development environments with rix"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{building-reproducible-development-environments-with-rix}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(rix)
```

<!-- WARNING - This vignette is generated by {fusen} from dev/building_envs_with_rix.Rmd: do not edit by hand -->

The goal of `{rix}` is to provide an easy way to generate `default.nix` files.
These files are used by the Nix package manager to build an environment
according to the instructions defined in the file. Users can specify which
version of R, R packages, other needed software, IDE etc should be available
within that environment. Writing such files can be daunting for newcomers, and
so `{rix}` provides a function called `rix()`, which generates such a file.

Users need to provide the following inputs to `rix()`:

- `r_ver`: the version of R required. Use "current" for the latest version;
- `r_pkgs`: the required R packages. For example "dplyr";
- `other_pkgs`: the required system packages, if needed. For example "quarto", or a Python interpreter;
- `git_pkgs`: list of git packages to add. See the example below;
- `ide`: the integrated development editor to use. For example "rstudio" if you want to use RStudio. Refer to the "Interactive work with {rix}" for more details;
- `path`: the path where to save the `default.nix` file.
- `overwrite`: whether to overwrite the `default.nix` file or not.


## Day-to-day use of {rix}

## Running old projects with {rix}

The example below shows how to create a `default.nix` with instructions to build
an environment with R version 4.2.1, the `{dplyr}` and `{janitor}` packages
and no specific IDE:


```{r}
path_default_nix <- tempdir()

rix(r_ver = "4.2.1",
    r_pkgs = c("dplyr", "janitor"),
    other_pkgs = c("quarto"),
    git_pkgs = NULL,
    ide = "other",
    path = path_default_nix,
    overwrite = TRUE)

```

The file looks like this:


```{r echo = F}
cat(readLines(paste0(path_default_nix, "/default.nix")), sep = "\n")
```

The first following line is quite important, as it shows which *revision* of
`nixpkgs` is being used for this environment. The *revision* is the commit
hash of that particular release of `nixpkgs`, here: `79b3d4bcae8`. This revision
of `nixpkgs` is the one that shipped version 4.2.1 of R, so the `{dplyr}` and
`{janitor}` packages that will get installed will be the versions available
in that revision as well.




Specifying a package on Github:


```{r}
rix(r_ver = "4.2.1",
    r_pkgs = c("dplyr", "janitor"),
    other_pkgs = c("quarto"),
    git_pkgs = list(package_name = "housing",
                    repo_url = "https://github.com/rap4all/housing/",
                    branch_name = "fusen",
                    commit = "1c860959310b80e67c41f7bbdc3e84cef00df18e"),
    ide = "other",
    path = path_default_nix,
    overwrite = TRUE)

```

```{r}
cat(readLines(paste0(path_default_nix, "/default.nix")), sep = "\n")
```

